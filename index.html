<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ZATCA Admin â€” Code Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=IBM+Plex+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --shell:      #0D1B2A;
            --shell-mid:  #132236;
            --shell-rim:  #1C3050;
            --coral:      #FF5C3A;
            --coral-dim:  #FF7A5C;
            --green:      #2EC4A9;
            --green-bg:   rgba(46,196,169,0.12);
            --green-bdr:  rgba(46,196,169,0.3);
            --red:        #E05C5C;
            --red-bg:     rgba(224,92,92,0.12);
            --red-bdr:    rgba(224,92,92,0.3);
            --amber:      #F4A93A;
            --font-d:     'Sora', system-ui, sans-serif;
            --font-m:     'IBM Plex Mono', monospace;
            --ease:       cubic-bezier(0.4,0,0.2,1);
        }

        *, *::before, *::after {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
        }

        html, body {
            min-height: 100%;
            font-family: var(--font-d);
            background: var(--shell);
            color: #fff;
            overscroll-behavior: none;
        }

        /* â”€â”€ Mesh background â”€â”€ */
        body::before {
            content: '';
            position: fixed; inset: 0; pointer-events: none; z-index: 0;
            background:
                radial-gradient(ellipse 70% 55% at 15% 10%, rgba(255,92,58,0.14) 0%, transparent 60%),
                radial-gradient(ellipse 55% 45% at 85% 85%, rgba(46,196,169,0.10) 0%, transparent 60%),
                radial-gradient(ellipse 90% 70% at 50% 50%, rgba(28,48,80,0.55) 0%, transparent 75%);
        }

        .page {
            position: relative; z-index: 1;
            min-height: 100vh;
            display: flex; flex-direction: column;
            align-items: center; justify-content: flex-start;
            padding: 40px 20px 60px;
        }

        /* â”€â”€ Header â”€â”€ */
        .header {
            text-align: center; margin-bottom: 36px;
        }
        .logo-wrap {
            display: inline-flex; align-items: center; gap: 14px;
            margin-bottom: 14px;
        }
        .logo-icon {
            width: 58px; height: 58px;
            background: linear-gradient(135deg, var(--coral), #FF8060);
            border-radius: 18px;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px;
            box-shadow: 0 8px 28px rgba(255,92,58,0.4);
        }
        .logo-title {
            font-size: 32px; font-weight: 800;
            letter-spacing: -1px; line-height: 1;
        }
        .logo-title span { color: var(--coral-dim); }
        .logo-sub {
            font-size: 11px; color: rgba(255,255,255,0.35);
            letter-spacing: 2px; text-transform: uppercase;
            font-weight: 600; margin-top: 4px;
        }
        .header-badge {
            display: inline-flex; align-items: center; gap: 7px;
            background: rgba(255,92,58,0.12);
            border: 1px solid rgba(255,92,58,0.25);
            border-radius: 100px;
            padding: 6px 16px; font-size: 12px; font-weight: 700;
            color: var(--coral-dim); letter-spacing: 0.5px;
        }

        /* â”€â”€ Main card â”€â”€ */
        .card {
            width: 100%; max-width: 480px;
            background: rgba(255,255,255,0.055);
            border: 1px solid rgba(255,255,255,0.10);
            border-radius: 28px;
            padding: 32px 28px;
            backdrop-filter: blur(14px);
            -webkit-backdrop-filter: blur(14px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.08);
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 13px; font-weight: 700;
            color: rgba(255,255,255,0.4);
            text-transform: uppercase; letter-spacing: 1.2px;
            margin-bottom: 22px;
            display: flex; align-items: center; gap: 8px;
        }
        .card-title-dot {
            width: 7px; height: 7px; border-radius: 50%;
            background: var(--coral); flex-shrink: 0;
        }

        /* â”€â”€ Field â”€â”€ */
        .field { margin-bottom: 20px; }
        .field:last-of-type { margin-bottom: 0; }

        .field label {
            display: block; font-size: 11px; font-weight: 700;
            color: rgba(255,255,255,0.42);
            text-transform: uppercase; letter-spacing: 0.9px;
            margin-bottom: 9px;
        }

        .field input {
            width: 100%; padding: 16px 18px;
            background: rgba(255,255,255,0.07);
            border: 1.5px solid rgba(255,255,255,0.12);
            border-radius: 14px; font-size: 16px;
            color: #FFFFFF; font-family: var(--font-m);
            transition: all 0.2s var(--ease);
            -webkit-appearance: none;
            min-height: 56px; text-align: center;
            letter-spacing: 4px; font-weight: 700;
            text-transform: uppercase;
        }
        .field input::placeholder {
            color: rgba(255,255,255,0.18);
            font-family: var(--font-d); letter-spacing: 0;
            font-size: 14px; font-weight: 400;
        }
        .field input:focus {
            outline: none;
            border-color: var(--coral);
            background: rgba(255,255,255,0.1);
            box-shadow: 0 0 0 4px rgba(255,92,58,0.18);
        }
        .field-hint {
            margin-top: 7px; font-size: 11px;
            color: rgba(255,255,255,0.3); text-align: center;
            font-family: var(--font-d); font-weight: 500;
        }

        /* â”€â”€ Generate Button â”€â”€ */
        .btn-generate {
            width: 100%; padding: 17px;
            background: linear-gradient(135deg, var(--coral), #FF7A5C);
            border: none; border-radius: 14px;
            font-size: 15px; font-weight: 700;
            color: #FFFFFF; cursor: pointer;
            display: flex; align-items: center; justify-content: center; gap: 9px;
            font-family: var(--font-d); letter-spacing: 0.3px;
            min-height: 56px; margin-top: 24px;
            box-shadow: 0 6px 24px rgba(255,92,58,0.42);
            transition: all 0.2s var(--ease);
        }
        .btn-generate:hover { box-shadow: 0 8px 30px rgba(255,92,58,0.55); transform: translateY(-1px); }
        .btn-generate:active { transform: scale(0.97); box-shadow: none; }
        .btn-generate:disabled { opacity: 0.4; cursor: not-allowed; transform: none !important; box-shadow: none !important; }

        /* â”€â”€ Result Card â”€â”€ */
        .result-card {
            width: 100%; max-width: 480px;
            background: var(--green-bg);
            border: 1px solid var(--green-bdr);
            border-radius: 28px; padding: 28px 28px 24px;
            text-align: center;
            animation: popIn 0.38s var(--ease) both;
            display: none;
        }
        .result-card.visible { display: block; }

        @keyframes popIn {
            from { opacity: 0; transform: scale(0.93) translateY(16px); }
            to   { opacity: 1; transform: scale(1) translateY(0); }
        }

        .result-label {
            font-size: 11px; font-weight: 700;
            color: rgba(46,196,169,0.65);
            text-transform: uppercase; letter-spacing: 1.5px;
            margin-bottom: 12px;
        }

        .result-code {
            font-family: var(--font-m);
            font-size: 44px; font-weight: 700;
            color: var(--green);
            letter-spacing: 10px;
            line-height: 1;
            text-shadow: 0 0 30px rgba(46,196,169,0.4);
            margin-bottom: 10px;
            word-break: break-all;
        }

        .result-device {
            font-size: 11px; color: rgba(255,255,255,0.3);
            font-family: var(--font-m); letter-spacing: 2px;
            margin-bottom: 22px;
        }

        .btn-row {
            display: flex; gap: 10px;
        }

        .btn-copy, .btn-whatsapp {
            flex: 1; padding: 14px 10px;
            border: none; border-radius: 12px;
            font-size: 13px; font-weight: 700;
            cursor: pointer; display: flex;
            align-items: center; justify-content: center; gap: 7px;
            font-family: var(--font-d);
            transition: all 0.2s var(--ease);
            min-height: 48px;
        }
        .btn-copy {
            background: rgba(46,196,169,0.18);
            border: 1px solid var(--green-bdr);
            color: var(--green);
        }
        .btn-copy:active { background: rgba(46,196,169,0.3); }

        .btn-whatsapp {
            background: rgba(37,211,102,0.15);
            border: 1px solid rgba(37,211,102,0.3);
            color: #25D366;
        }
        .btn-whatsapp:active { background: rgba(37,211,102,0.25); }

        /* â”€â”€ History â”€â”€ */
        .history-card {
            width: 100%; max-width: 480px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 24px;
            overflow: hidden;
            display: none;
        }
        .history-card.visible { display: block; }

        .history-header {
            padding: 16px 22px;
            font-size: 11px; font-weight: 700;
            color: rgba(255,255,255,0.35);
            text-transform: uppercase; letter-spacing: 1px;
            border-bottom: 1px solid rgba(255,255,255,0.07);
            display: flex; align-items: center; justify-content: space-between;
        }

        .history-clear {
            font-size: 11px; font-weight: 600;
            color: var(--red); cursor: pointer;
            background: none; border: none;
            font-family: var(--font-d); letter-spacing: 0;
            text-transform: none;
        }

        .history-list { max-height: 260px; overflow-y: auto; }

        .history-item {
            padding: 14px 22px;
            display: flex; align-items: center; justify-content: space-between;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer; transition: background 0.15s;
        }
        .history-item:last-child { border-bottom: none; }
        .history-item:hover { background: rgba(255,255,255,0.04); }
        .history-item:active { background: rgba(255,255,255,0.08); }

        .history-item-left {}
        .history-device {
            font-family: var(--font-m); font-size: 14px;
            font-weight: 700; color: rgba(255,255,255,0.75);
            letter-spacing: 2px; margin-bottom: 3px;
        }
        .history-time {
            font-size: 10px; color: rgba(255,255,255,0.25);
            font-weight: 500;
        }
        .history-code {
            font-family: var(--font-m); font-size: 18px;
            font-weight: 700; color: var(--green);
            letter-spacing: 3px;
        }

        /* â”€â”€ Footer â”€â”€ */
        .footer {
            margin-top: 32px; text-align: center;
            font-size: 11px; color: rgba(255,255,255,0.18);
            font-weight: 500; letter-spacing: 0.3px;
        }
        .footer span { color: rgba(255,92,58,0.45); margin: 0 4px; }

        /* Error state */
        .field input.error { border-color: var(--red) !important; box-shadow: 0 0 0 4px rgba(224,92,92,0.18) !important; }
        .error-msg {
            margin-top: 7px; font-size: 11px;
            color: #FFA5A5; text-align: center;
            font-weight: 600; display: none;
        }
        .error-msg.show { display: block; animation: shake 0.4s; }
        @keyframes shake {
            0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)}
        }

        /* Scrollbar */
        .history-list::-webkit-scrollbar { width: 4px; }
        .history-list::-webkit-scrollbar-track { background: transparent; }
        .history-list::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); border-radius: 4px; }
    </style>
</head>
<body>
<div class="page">

    <!-- Header -->
    <div class="header">
        <div class="logo-wrap">
            <div class="logo-icon">ğŸ”‘</div>
            <div>
                <div class="logo-title">ZATCA <span>Admin</span></div>
                <div class="logo-sub">Code Generator</div>
            </div>
        </div>
        <div class="header-badge">ğŸ” Ù…ÙˆÙ„Ù‘Ø¯ Ø±Ù…ÙˆØ² Ø§Ù„ØªÙØ¹ÙŠÙ„</div>
    </div>

    <!-- Input Card -->
    <div class="card">
        <div class="card-title"><span class="card-title-dot"></span>Generate Activation Code | ØªÙˆÙ„ÙŠØ¯ Ø±Ù…Ø² ØªÙØ¹ÙŠÙ„</div>

        <div class="field">
            <label>Customer Device Code | Ø±Ù…Ø² Ø¬Ù‡Ø§Ø² Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="deviceInput"
                   placeholder="e.g.  A3F7B2C1"
                   maxlength="8"
                   autocomplete="off"
                   autocorrect="off"
                   spellcheck="false">
            <div class="field-hint">The 8-character code shown on the customer's device</div>
            <div class="error-msg" id="errorMsg">âš ï¸ Please enter the device code (at least 4 characters)</div>
        </div>

        <button class="btn-generate" id="generateBtn">
            <span>âš¡</span>
            <span>Generate Code | ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ù…Ø²</span>
        </button>
    </div>

    <!-- Result Card -->
    <div class="result-card" id="resultCard">
        <div class="result-label">âœ… Activation Code | Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„</div>
        <div class="result-code" id="resultCode">â€”</div>
        <div class="result-device" id="resultDevice"></div>
        <div class="btn-row">
            <button class="btn-copy" id="copyBtn">ğŸ“‹ Copy</button>
            <button class="btn-whatsapp" id="waBtn">ğŸ’¬ WhatsApp</button>
        </div>
    </div>

    <!-- History Card -->
    <div class="history-card" id="historyCard">
        <div class="history-header">
            <span>Recent Codes | Ø§Ù„Ø³Ø¬Ù„</span>
            <button class="history-clear" id="clearHistoryBtn">Clear All</button>
        </div>
        <div class="history-list" id="historyList"></div>
    </div>

    <div class="footer">
        <span>ğŸ”’</span> ZATCA Admin Tool &nbsp;Â·&nbsp; v3.0 &nbsp;Â·&nbsp; Licensed System <span>ğŸ”’</span>
    </div>
</div>

<script>
(function() {
    'use strict';

    const SALT = 'ZATCA_Invoice_2024_SecureKey_v1';
    const WHATSAPP_NUMBER = '+966566958474';
    const HISTORY_KEY = 'zatca_admin_history';

    /* â”€â”€ Crypto â”€â”€ */
    async function sha256(text) {
        const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(text));
        return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
    }

    async function generateActivationCode(deviceCode) {
        const hash = await sha256(deviceCode.toUpperCase().trim() + SALT);
        return hash.replace(/[^0-9]/g, '').substring(0, 8);
    }

    /* â”€â”€ History â”€â”€ */
    function loadHistory() {
        try { return JSON.parse(localStorage.getItem(HISTORY_KEY)) || []; }
        catch { return []; }
    }

    function saveHistory(history) {
        localStorage.setItem(HISTORY_KEY, JSON.stringify(history.slice(0, 20)));
    }

    function addToHistory(deviceCode, activationCode) {
        const history = loadHistory();
        // Remove duplicate
        const filtered = history.filter(h => h.device !== deviceCode.toUpperCase());
        filtered.unshift({
            device: deviceCode.toUpperCase(),
            code: activationCode,
            time: new Date().toLocaleString('en-GB', { day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit' })
        });
        saveHistory(filtered);
        renderHistory();
    }

    function renderHistory() {
        const history = loadHistory();
        const historyCard = document.getElementById('historyCard');
        const historyList = document.getElementById('historyList');

        if (history.length === 0) {
            historyCard.classList.remove('visible');
            return;
        }

        historyCard.classList.add('visible');
        historyList.innerHTML = history.map((h, i) => `
            <div class="history-item" data-code="${h.code}" data-device="${h.device}">
                <div class="history-item-left">
                    <div class="history-device">${h.device}</div>
                    <div class="history-time">${h.time}</div>
                </div>
                <div class="history-code">${h.code}</div>
            </div>
        `).join('');

        // Click history item to reload
        historyList.querySelectorAll('.history-item').forEach(item => {
            item.addEventListener('click', function() {
                document.getElementById('deviceInput').value = this.dataset.device;
                showResult(this.dataset.device, this.dataset.code);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });
    }

    /* â”€â”€ Show result â”€â”€ */
    function showResult(deviceCode, activationCode) {
        const resultCard = document.getElementById('resultCard');
        document.getElementById('resultCode').textContent = activationCode;
        document.getElementById('resultDevice').textContent = `Device: ${deviceCode.toUpperCase()}`;
        resultCard.classList.remove('visible');
        // Force reflow for animation replay
        void resultCard.offsetWidth;
        resultCard.classList.add('visible');
    }

    /* â”€â”€ Generate â”€â”€ */
    document.getElementById('generateBtn').addEventListener('click', async function() {
        const input = document.getElementById('deviceInput');
        const errorMsg = document.getElementById('errorMsg');
        const deviceCode = input.value.trim().toUpperCase();

        // Reset error
        input.classList.remove('error');
        errorMsg.classList.remove('show');

        if (deviceCode.length < 4) {
            input.classList.add('error');
            errorMsg.classList.add('show');
            input.focus();
            return;
        }

        this.disabled = true;
        this.innerHTML = '<span>â³</span><span>Generating...</span>';

        const code = await generateActivationCode(deviceCode);

        showResult(deviceCode, code);
        addToHistory(deviceCode, code);

        this.disabled = false;
        this.innerHTML = '<span>âš¡</span><span>Generate Code | ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø±Ù…Ø²</span>';
    });

    /* Auto-uppercase input */
    document.getElementById('deviceInput').addEventListener('input', function() {
        const pos = this.selectionStart;
        this.value = this.value.toUpperCase();
        this.setSelectionRange(pos, pos);
        this.classList.remove('error');
        document.getElementById('errorMsg').classList.remove('show');
    });

    /* Enter key */
    document.getElementById('deviceInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') document.getElementById('generateBtn').click();
    });

    /* â”€â”€ Copy button â”€â”€ */
    document.getElementById('copyBtn').addEventListener('click', function() {
        const code = document.getElementById('resultCode').textContent;
        navigator.clipboard.writeText(code).then(() => {
            this.innerHTML = 'âœ… Copied!';
            setTimeout(() => { this.innerHTML = 'ğŸ“‹ Copy'; }, 2000);
        }).catch(() => {
            // Fallback
            const ta = document.createElement('textarea');
            ta.value = code; ta.style.position = 'fixed'; ta.style.opacity = '0';
            document.body.appendChild(ta); ta.select(); document.execCommand('copy');
            document.body.removeChild(ta);
            this.innerHTML = 'âœ… Copied!';
            setTimeout(() => { this.innerHTML = 'ğŸ“‹ Copy'; }, 2000);
        });
    });

    /* â”€â”€ WhatsApp share â”€â”€ */
    document.getElementById('waBtn').addEventListener('click', function() {
        const code = document.getElementById('resultCode').textContent;
        const device = document.getElementById('deviceInput').value.trim().toUpperCase();
        const msg = `Ù…Ø±Ø­Ø¨Ø§Ù‹ ğŸ‘‹\n\nØ±Ù…Ø² ØªÙØ¹ÙŠÙ„ Ù†Ø¸Ø§Ù… ZATCA Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:\n\n*${code}*\n\nØ£Ø¯Ø®Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù…Ø² ÙÙŠ Ø´Ø§Ø´Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„.\nDevice Code: ${device}\n\nØ´ÙƒØ±Ø§Ù‹ ğŸ™`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    });

    /* â”€â”€ Clear history â”€â”€ */
    document.getElementById('clearHistoryBtn').addEventListener('click', function() {
        if (confirm('Clear all history?')) {
            localStorage.removeItem(HISTORY_KEY);
            renderHistory();
        }
    });

    /* â”€â”€ Init â”€â”€ */
    renderHistory();
    document.getElementById('deviceInput').focus();

})();
</script>
</body>
</html>
